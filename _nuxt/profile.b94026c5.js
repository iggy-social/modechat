import{H as F,T as L,M as U}from"./components.4d04046e.js";import{a as I,I as E,C as M,l as D,r as p,o,b as a,m as r,F as k,G as $,e as m,f as s,t as h,q as v,A as O,x,S as B,c as b,u as P,i as u,w as _,D as C,y as j,z as V,h as z,T as H}from"./entry.042868d5.js";import{g as q,a as W,b as G,c as K}from"./domainUtils.ebde516a.js";import{g as A}from"./textUtils.37f55cdd.js";import{u as Y}from"./user.cc692d1d.js";import{P as Z}from"./ProfileImage.59d46877.js";import{F as J}from"./FileUploadModal.4850a1ec.js";import{M as Q}from"./MintedPostImage.1e770ed5.js";import{C as R}from"./ChatFeed.7c3bc425.js";import{g as X}from"./balanceUtils.d20279c1.js";import{a as ee,s as S,b as T}from"./storageUtils.23a37160.js";import"./composables.c81ff67b.js";import"./site.1efb48c2.js";import"./ChatPost.5a72f03c.js";import"./WaitingToast.0757716f.js";import"./ConnectWalletButton.449eaa9c.js";const se={name:"UserMintedPosts",props:["address"],data(){return{loadingMintedPosts:!1,mintedPostIds:[],postsDifference:0}},components:{MintedPostImage:Q},mounted(){this.fetchMintedPostIds()},methods:{async fetchMintedPostIds(){this.loadingMintedPosts=!0;let e=this.$getFallbackProvider(this.$config.supportedChainId);this.isActivated&&this.chainId===this.$config.supportedChainId&&(e=this.signer);const i=new E(["function getMintedPostIdsArray(address) external view returns (uint256[] memory)"]);let d=await new M(this.$config.iggyPostStatsAddress,i,e).getMintedPostIdsArray(this.address);d=[...d].reverse(),this.mintedPostIds=d.slice(0,this.$config.profileMintedPostIdsMax),this.postsDifference=d.length-this.mintedPostIds.length,this.loadingMintedPosts=!1}},setup(){const{isActivated:e,chainId:i,signer:n}=D();return{isActivated:e,chainId:i,signer:n}}},te={key:0,class:"d-flex justify-content-center mb-3"},ie=s("span",{class:"spinner-border spinner-border-lg",role:"status","aria-hidden":"true"},null,-1),oe=[ie],ne={key:1,class:"row"},ae={key:2,class:"d-flex justify-content-center mt-3"},re={key:3},le=s("p",null,"No minted posts yet.",-1),de=[le];function ce(e,i,n,d,t,l){const f=p("MintedPostImage");return o(),a(k,null,[t.loadingMintedPosts?(o(),a("div",te,oe)):r("",!0),t.mintedPostIds?(o(),a("div",ne,[(o(!0),a(k,null,$(t.mintedPostIds,c=>(o(),a("div",{class:"col-6 col-sm-4 col-md-3 mb-2",key:c},[m(f,{id:c},null,8,["id"])]))),128))])):r("",!0),t.postsDifference>0?(o(),a("div",ae,[s("p",null,"+ "+h(t.postsDifference)+" other minted posts",1)])):r("",!0),!t.loadingMintedPosts&&t.mintedPostIds.length===0?(o(),a("div",re,de)):r("",!0)],64)}const he=I(se,[["render",ce]]),me={name:"PunkProfile",props:["pAddress","pDomain"],data(){return{balanceAp:0,balanceChatTokenWei:0,currentTab:"posts",domain:this.pDomain,emailForNotificationsSet:!1,followers:0,following:0,lastActivityTimestamp:null,newEmail:null,newImageLink:null,orbisImage:null,orbisProfile:null,uAddress:this.pAddress,uBalance:0,uDid:null,waitingDataLoad:!1,waitingImageUpdate:!1,waitingSetEmail:!1}},components:{ChatFeed:R,FileUploadModal:J,ProfileImage:Z,UserMintedPosts:he},mounted(){this.currentTab=localStorage.getItem("profileCurrentTab"),this.currentTab||(this.currentTab="posts"),(!this.pAddress||!this.pDomain)&&this.fetchAddressAndDomain(),this.checkConnectionToOrbis()},computed:{balanceChatToken(){const e=v(this.balanceChatTokenWei);return e>=0?Math.floor(Number(e)):Number(e).toFixed(4)},balanceEth(){const e=v(this.uBalance);return e>0?Number(e).toFixed(2):Number(e).toFixed(4)},getChatName(){return this.domain&&this.domain.endsWith(this.$config.tldName)?this.domain.replace(this.$config.tldName,""):null},getOrbisContext(){return this.$config.orbisTest?this.$config.orbisTestContext:this.$config.chatChannels.general},isCurrentUser(){return String(this.uAddress).toLowerCase()===String(this.address).toLowerCase()},isEmail(){return!!(this.newEmail&&this.newEmail.includes("@")&&this.newEmail.includes("."))},isImage(){return!!(this.newImageLink&&(this.newImageLink.includes(".jpg")||this.newImageLink.includes(".jpeg")||this.newImageLink.includes(".png")||this.newImageLink.includes(".gif")||this.newImageLink.includes(".webp")))}},methods:{changeCurrentTab(e){this.currentTab=e,localStorage.setItem("profileCurrentTab",e)},async changeImage(){if(this.userStore.getIsConnectedToOrbis){this.waitingImageUpdate=!0,this.orbisProfile||(this.orbisProfile={pfp:"",username:""}),this.orbisProfile.pfp=this.newImageLink,!this.orbisProfile.username&&this.domain&&(this.orbisProfile.username=this.domain);const e=await this.$orbis.updateProfile(this.orbisProfile);e.status!==200?(console.log("Error: ",e),this.toast(e.result,{type:"error"}),this.waitingImageUpdate=!1):(this.orbisImage=this.newImageLink,this.userStore.setOrbisImage(this.newImageLink),sessionStorage.setItem(String(this.address).toLowerCase()+"-img",this.newImageLink),this.toast("Image successfully updated!",{type:"success"}),this.waitingImageUpdate=!1)}else this.toast("Please connect to chat first",{type:"error"})},async checkConnectionToOrbis(){this.userStore.getIsConnectedToOrbis||(await this.$orbis.isConnected()?(this.userStore.setIsConnectedToOrbis(!0),this.$orbis.session&&!this.userStore.getDid&&(this.userStore.setDid(this.$orbis.session.did._id),this.userStore.setDidParent(this.$orbis.session.did._parentId))):this.userStore.setIsConnectedToOrbis(!1))},async connectToOrbis(){if(!this.userStore.getIsConnectedToOrbis){let e=await this.$orbis.connect_v2({provider:this.signer.provider.provider,lit:!1});e.status==200?(this.userStore.setIsConnectedToOrbis(!0),this.$orbis.session&&(this.userStore.setDid(this.$orbis.session.did._id),this.userStore.setDidParent(this.$orbis.session.did._parentId))):(console.log("Error connecting to Ceramic: ",e),this.toast(e.result,{type:"error"}))}},async fetchAddressAndDomain(){if(this.waitingDataLoad=!0,this.$route.query.id){const i=this.$route.query.id;i.includes(".")?this.domain=i:this.uAddress=i}else this.uAddress=this.address;!this.domain&&this.uAddress&&(this.domain=ee(window,this.uAddress));let e=this.$getFallbackProvider(this.$config.supportedChainId);if(this.isActivated&&this.chainId===this.$config.supportedChainId&&(e=this.signer),!this.domain&&this.uAddress){const i=await q(this.uAddress,e);i?(this.domain=i+this.$config.tldName,S(window,this.uAddress,this.domain)):(this.domain=await W(this.uAddress),T(window,this.uAddress,this.domain))}if(this.domain&&!this.uAddress){const i=String(this.domain).toLowerCase().split(".")[1];let n;i==this.$config.tldName.replace(".","")?n=await G(String(this.domain).toLowerCase().split(".")[0],e):i==this.$config.altDomain.replace(".","")&&(n=await K(String(this.domain).toLowerCase().split(".")[0])),n!==O&&n!=null&&(this.uAddress=n),String(this.domain).toLowerCase().split(".")[1]==this.$config.tldName.replace(".","")?S(window,this.uAddress,this.domain):String(this.domain).toLowerCase().split(".")[1]==this.$config.altDomain.replace(".","")&&T(window,this.uAddress,this.domain)}await this.fetchOrbisProfile(),await this.fetchBalance()},async fetchBalance(){if(this.uAddress){let e=this.$getFallbackProvider(this.$config.supportedChainId);if(this.uBalance=await e.getBalance(this.uAddress),this.$config.chatTokenAddress){const i=new E(["function balanceOf(address owner) view returns (uint256)"]),n=new M(this.$config.chatTokenAddress,i,e);this.balanceChatTokenWei=await n.balanceOf(this.uAddress)}this.$config.activityPointsAddress&&this.$config.showFeatures.activityPoints&&(this.balanceAp=await X(this.uAddress,e))}},async fetchOrbisProfile(){if(this.orbisProfile={pfp:"",username:""},this.uAddress){let{data:e,error:i}=await this.$orbis.getDids(this.uAddress);if(e[0]?.did){this.uDid=e[0].did;const n=await this.$orbis.getProfile(e[0].did);n.status===200&&(this.orbisProfile=n.data.details.profile,n&&n.data.details.profile&&n.data.details.profile.pfp&&(this.orbisImage=n.data.details.profile.pfp),n&&(this.followers=n.data.count_followers,this.following=n.data.count_following,this.lastActivityTimestamp=n.data.last_activity_timestamp),n.data.details.encrypted_email?this.emailForNotificationsSet=!0:this.emailForNotificationsSet=!1,this.waitingDataLoad=!1)}this.waitingDataLoad=!1}},async insertImage(e){this.newImageLink=e,this.changeImage()},async setEmailNotifications(e){if(this.userStore.getIsConnectedToOrbis){this.waitingSetEmail=!0,e&&(this.newEmail="");let i=await this.$orbis.setEmail(this.newEmail);i.status!==200?(console.log("Error: ",i),this.toast(i.result,{type:"error"}),this.waitingSetEmail=!1):(this.toast("Email notifications successfully set!",{type:"success"}),this.waitingSetEmail=!1,document.getElementById("setEmailModalClose").click())}else this.toast("Please connect to chat first",{type:"error"})}},setup(){const{address:e,balance:i,chainId:n,isActivated:d,signer:t}=D(),l=Y(),f=x();return{address:e,balance:i,chainId:n,isActivated:d,userStore:l,shortenAddress:B,signer:t,toast:f}},watch:{address(){this.fetchAddressAndDomain()}}},ue={class:"card border"},fe={class:"card-body"},ge=s("i",{class:"bi bi-arrow-left-circle cursor-pointer"},null,-1),pe=[ge],be={class:"row"},_e={class:"col-md-3 mt-3"},we={class:"col-md-9 mt-3"},ye={key:0,class:"mb-3"},Ce={key:1,class:"mb-3"},ke={class:"mt-4 muted-text",style:{"font-size":"14px"}},Ie={class:"me-4"},ve=s("i",{class:"bi bi-wallet me-1"},null,-1),Pe={key:0,class:"me-4"},Ae=s("i",{class:"bi bi-wallet me-1"},null,-1),Se={key:1,class:"me-4"},Te=s("i",{class:"bi bi-wallet me-1"},null,-1),Ee={key:2,class:"me-4"},Me=s("i",{class:"bi bi-key-fill me-2"},null,-1),De={class:"me-4"},Ne=s("i",{class:"bi bi-box-arrow-up-right me-2"},null,-1),Fe=["href"],Le={key:2,class:"mt-2"},Ue={class:"dropdown mt-2"},$e=s("button",{class:"btn btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("i",{class:"bi bi-sliders"}),u(" Profile settings ")],-1),Oe={class:"dropdown-menu"},xe={key:0,class:"dropdown-item cursor-pointer","data-bs-toggle":"modal","data-bs-target":"#verifyAccountModal"},Be=s("i",{class:"bi bi-person-check-fill"},null,-1),je=["data-bs-target"],Ve=s("i",{class:"bi bi-person-circle"},null,-1),ze=z('<span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#changeUsernameModal"><i class="bi bi-pencil-square"></i> Change your username </span><span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#setEmailModal"><i class="bi bi-envelope-at-fill"></i> Set email notification for chat </span><span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#chatSettingsModal"><i class="bi bi-gear-fill"></i> Other settings </span><span class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#referralModal"><i class="bi bi-person-plus-fill"></i> Share referral link </span>',4),He=s("i",{class:"bi bi-send"},null,-1),qe={class:"modal fade",id:"setEmailModal",tabindex:"-1","aria-labelledby":"setEmailModalLabel","aria-hidden":"true"},We={class:"modal-dialog"},Ge={class:"modal-content"},Ke=s("div",{class:"modal-header"},[s("h1",{class:"modal-title fs-5",id:"setEmailModalLabel"},"Set email notifications"),s("button",{type:"button",id:"setEmailModalClose",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ye={class:"modal-body"},Ze={key:0},Je=s("p",null,"First connect to Ceramic to set email notifications:",-1),Qe={key:1,class:"mt-3"},Re=s("p",null,"Enter your email address to receive notifications about replies on your posts.",-1),Xe=s("p",null,"The email address will be encrypted and will not be publicly visible.",-1),es={key:0},ss={key:1},ts={key:2,class:"text-danger"},is={class:"modal-footer"},os=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),ns=["disabled"],as={key:0,class:"spinner-border spinner-border-sm mx-1",role:"status","aria-hidden":"true"},rs={class:"card border mt-3 mb-3"},ls={class:"card-body"},ds={class:"nav nav-tabs nav-fill"},cs={class:"nav-item"},hs={class:"nav-item"},ms={class:"tab-content mt-3"},us={key:0},fs={key:1};function gs(e,i,n,d,t,l){const f=p("ProfileImage"),c=H,w=p("FileUploadModal"),y=p("ChatFeed"),N=p("UserMintedPosts");return o(),a("div",null,[s("div",ue,[s("div",fe,[s("p",{class:"fs-3",onClick:i[0]||(i[0]=g=>e.$router.back())},pe),s("div",be,[s("div",_e,[t.uAddress?(o(),b(f,{key:t.orbisImage,class:"img-fluid img-thumbnail rounded-circle col-6 col-md-12",address:t.uAddress,domain:t.domain,image:t.orbisImage},null,8,["address","domain","image"])):r("",!0)]),s("div",we,[t.domain&&!l.isCurrentUser?(o(),a("h3",ye,h(P(A)(t.domain)),1)):r("",!0),t.domain&&l.isCurrentUser?(o(),a("h3",Ce,h(P(A)(d.userStore.getDefaultDomain)),1)):r("",!0),s("div",ke,[s("p",Ie,[ve,u(" "+h(l.balanceEth)+" "+h(e.$config.tokenSymbol),1)]),e.$config.chatTokenAddress?(o(),a("p",Pe,[Ae,u(" "+h(l.balanceChatToken)+" "+h(e.$config.chatTokenSymbol),1)])):r("",!0),e.$config.activityPointsAddress&&e.$config.showFeatures.activityPoints?(o(),a("p",Se,[Te,u(" "+h(t.balanceAp)+" AP ",1)])):r("",!0),e.$config.keysAddress&&e.$config.showFeatures.friendKeys&&l.getChatName?(o(),a("p",Ee,[Me,m(c,{class:"body-color hover-color",to:"/keys/?username="+l.getChatName},{default:_(()=>[u("Get Friend Key")]),_:1},8,["to"])])):r("",!0),s("p",De,[Ne,s("a",{href:e.$config.blockExplorerBaseUrl+"/address/"+t.uAddress,target:"_blank",class:"body-color hover-color",style:{"text-decoration":"none"}},h(d.shortenAddress(t.uAddress)),9,Fe)])]),l.isCurrentUser?(o(),a("div",Le,[s("div",Ue,[$e,s("div",Oe,[d.userStore.getIsConnectedToOrbis?r("",!0):(o(),a("span",xe,[Be,u(" Verify account ownership ")])),s("span",{class:C(["dropdown-item cursor-pointer",d.userStore.getIsConnectedToOrbis?"":"disabled"]),"data-bs-toggle":"modal","data-bs-target":"#fileUploadModal"+e.$.uid},[Ve,u(" Change your profile picture ")],10,je),ze])])])):r("",!0),t.domain&&!l.isCurrentUser&&e.$config.showFeatures.sendTokens?(o(),b(c,{key:3,class:"btn btn-primary mt-2",to:"/send-tokens/?to="+t.domain},{default:_(()=>[He,u(" Send tokens to "+h(t.domain),1)]),_:1},8,["to"])):r("",!0)])])]),s("div",qe,[s("div",We,[s("div",Ge,[Ke,s("div",Ye,[d.userStore.getIsConnectedToOrbis?r("",!0):(o(),a("div",Ze,[Je,s("button",{class:"btn btn-primary",onClick:i[1]||(i[1]=(...g)=>l.connectToOrbis&&l.connectToOrbis(...g))},"Connect to Ceramic")])),d.userStore.getIsConnectedToOrbis?(o(),a("div",Qe,[Re,Xe,t.emailForNotificationsSet?(o(),a("p",es," Currently, the email for notifications is already set. You can change it by entering a new email address below: ")):r("",!0),t.emailForNotificationsSet?r("",!0):(o(),a("p",ss," Currently, the email for notifications is NOT yet set. You can add your email address below: ")),j(s("input",{"onUpdate:modelValue":i[2]||(i[2]=g=>t.newEmail=g),type:"email",class:"form-control mt-2",placeholder:"Enter email address"},null,512),[[V,t.newEmail]]),t.newEmail&&!l.isEmail?(o(),a("small",ts," Error: The entered text is not an email. ")):r("",!0)])):r("",!0)]),s("div",is,[os,s("button",{type:"button",class:"btn btn-primary",onClick:i[3]||(i[3]=g=>l.setEmailNotifications(!1)),disabled:!d.userStore.getIsConnectedToOrbis||!l.isEmail},[t.waitingSetEmail?(o(),a("span",as)):r("",!0),u(" Submit email ")],8,ns)])])])]),d.userStore.getIsConnectedToOrbis?(o(),b(w,{key:0,onProcessFileUrl:l.insertImage,title:"Change profile image",infoText:"Upload a new profile picture.",componentId:e.$.uid,maxFileSize:e.$config.fileUploadSizeLimit},null,8,["onProcessFileUrl","componentId","maxFileSize"])):r("",!0)]),s("div",rs,[s("div",ls,[s("ul",ds,[s("li",cs,[s("button",{class:C(["nav-link",t.currentTab==="posts"?"active":""]),onClick:i[4]||(i[4]=g=>l.changeCurrentTab("posts"))},"Posts",2)]),s("li",hs,[s("button",{class:C(["nav-link",t.currentTab==="mints"?"active":""]),onClick:i[5]||(i[5]=g=>l.changeCurrentTab("mints"))},"Mints",2)])]),s("div",ms,[t.currentTab==="posts"&&t.uDid?(o(),a("div",us,[m(y,{byDid:t.uDid,hideCommentBox:!0,orbisContext:l.getOrbisContext},null,8,["byDid","orbisContext"])])):r("",!0),t.currentTab==="mints"&&t.uAddress?(o(),a("div",fs,[m(N,{address:t.uAddress},null,8,["address"])])):r("",!0)])])])])}const ps=I(me,[["render",gs]]),bs={name:"Profile",components:{PunkProfile:ps},setup(){}};function _s(e,i,n,d,t,l){const f=L,c=U,w=F,y=p("PunkProfile");return o(),a(k,null,[m(w,null,{default:_(()=>[m(f,null,{default:_(()=>[u("Profile | "+h(e.$config.projectMetadataTitle),1)]),_:1}),m(c,{name:"description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"]),m(c,{property:"og:image",content:e.$config.projectUrl+e.$config.previewImageProfile},null,8,["content"]),m(c,{property:"og:description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"]),m(c,{name:"twitter:image",content:e.$config.projectUrl+e.$config.previewImageProfile},null,8,["content"]),m(c,{name:"twitter:description",content:"Check out this profile on "+e.$config.projectName+"!"},null,8,["content"])]),_:1}),(o(),b(y,{key:e.$route.query.id,class:"mt-1"}))],64)}const Us=I(bs,[["render",_s]]);export{Us as default};
