import{H as w,T as S,M as C}from"./components.0d828f82.js";import{u as U}from"./notifications.b916379b.js";import{a as y,S as g,o as s,b as n,f as o,e as l,w as u,c as v,i as h,t as p,m as r,r as k,T as x,x as I,F as N,G as L}from"./entry.e3bcdc19.js";import{P as T}from"./ProfileImage.a400e725.js";import{g as O,a as P}from"./domainUtils.0e9a2901.js";import{a as b,s as M,b as B}from"./storageUtils.243b613e.js";import{g as $}from"./textUtils.c31f99e3.js";import"./composables.339d5292.js";const V={name:"OrbisNotification",props:["notification"],components:{ProfileImage:T},data(){return{authorAddress:null,authorDomain:null,authorImage:null,lengthLimit:150}},mounted(){this.notification&&(this.authorAddress=this.notification.user_notifiying_details.did.split(":")[4],this.authorDomain=b(window,this.authorAddress),!this.authorDomain&&this.notification.user_notifiying_details?.profile?.username&&(this.authorDomain=this.notification.user_notifiying_details.profile.username),this.authorImage=sessionStorage.getItem(String(this.authorAddress).toLowerCase()+"-img"),!this.authorImage&&this.notification.user_notifiying_details?.profile?.pfp&&(this.authorImage=this.notification.user_notifiying_details.profile.pfp),this.fetchUserDomain())},computed:{getNotificationAction(){return this.notification.family==="reply_to"?"reply":this.notification.family==="reaction"&&this.notification.content.type==="like"?"like":""},getNotificationContent(){if(this.notification?.content?.body){const t=this.notification.content.body;return t.length>this.lengthLimit?t.substring(0,this.lengthLimit)+"...":t}else if(this.notification?.post_details?.content?.body){const t=this.notification.post_details.content.body;return t.length>this.lengthLimit?t.substring(0,this.lengthLimit)+"...":t}return""},getPostStreamId(){return this.notification?.post_details?.stream_id?this.notification.post_details.stream_id:null},getUsernameOrAddress(){return this.authorDomain?this.authorDomain:this.authorAddress},getUsernameOrShortAddress(){if(this.notification)return this.authorAddress=this.notification.user_notifiying_details.did.split(":")[4],this.authorDomain=b(window,this.authorAddress),this.authorDomain?$(this.authorDomain):g(this.authorAddress)}},methods:{getDomainName:O,async fetchUserDomain(){const t=await this.getDomainName(this.authorAddress);t?(this.authorDomain=t,M(window,this.authorAddress,t+this.$config.tldName)):(this.authorDomain=await P(this.authorAddress),B(window,this.authorAddress,this.authorDomain))},openPostDetails(){this.$router.push({name:"post",query:{id:this.getPostStreamId}})}},setup(){return{shortenAddress:g}}},H={class:"card mb-3 border"},j={class:"card-body row"},F={class:"col-2 col-md-1"},q={class:"col-10 col-md-11"},E={class:"mt-0 link-without-color"},G={key:0},R=o("i",{class:"bi bi-chat-dots-fill ms-1 text-primary"},null,-1),W={key:1},z=o("i",{class:"bi bi-heart-fill ms-1 text-primary"},null,-1);function J(t,i,A,c,a,e){const m=k("ProfileImage"),f=x;return s(),n("div",H,[o("div",j,[o("div",F,[l(f,{to:"/profile/?id="+e.getUsernameOrAddress},{default:u(()=>[(s(),v(m,{class:"img-fluid rounded-circle",address:a.authorAddress,domain:a.authorDomain,image:a.authorImage,key:a.authorAddress},null,8,["address","domain","image"]))]),_:1},8,["to"])]),o("div",q,[o("p",E,[l(f,{class:"link-without-color hover-color",to:"/profile/?id="+e.getUsernameOrAddress},{default:u(()=>[h(p(e.getUsernameOrShortAddress),1)]),_:1},8,["to"]),e.getNotificationAction==="reply"?(s(),n("span",G,[R,h(" replied to your post ")])):r("",!0),e.getNotificationAction==="like"?(s(),n("span",W,[z,h(" liked your post ")])):r("",!0)]),o("p",{class:"mb-0 cursor-pointer text-break",onClick:i[0]||(i[0]=(..._)=>e.openPostDetails&&e.openPostDetails(..._))},p(e.getNotificationContent),1)])])])}const K=y(V,[["render",J]]),Q={name:"Notifications",components:{OrbisNotification:K},data(){return{clearingNotifications:!1}},methods:{async clearNotifications(){this.clearingNotifications=!0;let t=Math.floor(Date.now()/1e3),i=await this.$orbis.setNotificationsReadTime({type:"social",timestamp:Number(t),context:this.$config.chatChannels.general});i.status===200?(this.notificationsStore.setNotifications([]),this.notificationsStore.setUnreadNotificationsCount(0),this.clearingNotifications=!1):(console.log(i),this.toast(i.result,{type:"error"}),this.clearingNotifications=!1)}},setup(){const t=U(),i=I();return{notificationsStore:t,toast:i}}},X={class:"card border"},Y={class:"card-body"},Z=o("i",{class:"bi bi-arrow-left-circle cursor-pointer"},null,-1),tt=[Z],it={class:"mb-3 mt-3"},ot={key:0,class:"spinner-border spinner-border-md",role:"status","aria-hidden":"true"},st=["disabled"],et={key:0,class:"bi bi-trash3-fill"},nt={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},at={key:0,class:"mt-5 mb-5"},rt=o("p",null,"No unread notifications.",-1),ct=[rt];function lt(t,i,A,c,a,e){const m=S,f=C,_=w,D=k("OrbisNotification");return s(),n(N,null,[l(_,null,{default:u(()=>[l(m,null,{default:u(()=>[h("Notifications | "+p(t.$config.projectMetadataTitle),1)]),_:1}),l(f,{property:"og:title",content:"Notifications | "+t.$config.projectMetadataTitle},null,8,["content"])]),_:1}),o("div",X,[o("div",Y,[o("p",{class:"fs-3",onClick:i[0]||(i[0]=d=>t.$router.back())},tt),o("h3",it,[h(" Notifications "),c.notificationsStore.getLoadingNotifications?(s(),n("span",ot)):r("",!0),c.notificationsStore.getUnreadNotificationsCount>0&&!c.notificationsStore.getLoadingNotifications?(s(),n("button",{key:1,class:"btn btn-primary btn-sm",onClick:i[1]||(i[1]=(...d)=>e.clearNotifications&&e.clearNotifications(...d)),disabled:a.clearingNotifications},[a.clearingNotifications?r("",!0):(s(),n("i",et)),a.clearingNotifications?(s(),n("span",nt)):r("",!0)],8,st)):r("",!0)]),(s(!0),n(N,null,L(c.notificationsStore.getNotifications,d=>(s(),n("div",{key:d},[l(D,{notification:d},null,8,["notification"])]))),128)),c.notificationsStore.getUnreadNotificationsCount===0?(s(),n("div",at,ct)):r("",!0)])])],64)}const Nt=y(Q,[["render",lt]]);export{Nt as default};
